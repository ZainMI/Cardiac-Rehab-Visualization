name: Check Recent Dependabot Alerts
on:
  schedule:
    - cron: "0 0 * * *"
  workflow_dispatch:

permissions:
  security-events: read

jobs:
  check-alerts:
    runs-on: ubuntu-latest
    steps:
      - name: Fetch Alerts
        id: fetch-alerts
        env:
          GH_REPO: ${{ github.repository }}
        run: |
          ALERTS_JSON=$(gh api --paginate "/repos/$GH_REPO/dependabot/alerts?state=open" \
            --jq "$(cat <<'EOF'
              map(select(
                (.created_at | fromdateiso8601) > (now - 86400)
              ))
          EOF
          )")
          echo "alerts_json=$ALERTS_JSON" >> $GITHUB_OUTPUT

      - name: Process Alerts
        if: steps.fetch-alerts.outputs.alerts_json != '[]'
        run: |
          echo "Found alerts: ${{ steps.fetch-alerts.outputs.alerts_json }}"
